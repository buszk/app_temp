<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Med School PS Manager</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header>
      <h1>Personal Statement Manager</h1>
      <p class="subtitle">Local-only web app for customizing PS per school</p>
    </header>

    <nav class="tabs">
      <button class="tab-btn active" data-tab="template">Template</button>
      <button class="tab-btn" data-tab="schools">Schools</button>
      <button class="tab-btn" data-tab="customize">Customize</button>
    </nav>

    <main>
      <section id="tab-template" class="tab active">
        <h2>Template</h2>
        <p>Use <code>&lt;CUSTOMIZE_TO_SCHOOL&gt;</code> where school-specific content should go.</p>
        <textarea id="template-input" placeholder="Write your base personal statement template here..."></textarea>
        <div class="row">
          <button id="save-template">Save Template</button>
          <span id="template-status" class="status"></span>
        </div>

        <h3 style="margin-top:16px">OpenAI (optional)</h3>
        <div class="row wrap">
          <input id="openai-key" type="password" placeholder="OpenAI API Key (sk-...)" style="min-width:320px" />
          <button id="save-openai-key">Save API Key</button>
          <span id="openai-status" class="status"></span>
        </div>
        <p class="muted">Key is stored locally in your browser. Calls are made directly from your browser and may require serving this app over http(s) due to CORS.</p>
      </section>

      <section id="tab-schools" class="tab">
        <h2>Schools</h2>
        <div class="row">
          <input id="school-name" placeholder="Add school name" />
          <button id="add-school">Add</button>
        </div>
        <ul id="school-list" class="list"></ul>

        <h3 style="margin-top:16px">School Details</h3>
        <div class="row wrap">
          <label for="school-manage-select">Edit details for:</label>
          <select id="school-manage-select"></select>
        </div>
        <label for="school-research"><strong>Research Findings (authoritative)</strong></label>
        <textarea id="school-research" placeholder="Paste your vetted facts about the school: programs, mission, partnerships, stats, etc."></textarea>
        <div class="row">
          <button id="save-research">Save Research</button>
          <span id="research-status" class="status"></span>
        </div>
        <div style="margin-top:8px">
          <label for="school-tag-input"><strong>Tags</strong> (comma or Enter to add)</label>
          <div class="row wrap">
            <input id="school-tag-input" placeholder="e.g. research school, community school" />
            <button id="add-tag">Add Tag</button>
          </div>
          <div id="school-tags" class="tags"></div>
        </div>
      </section>

      <section id="tab-customize" class="tab">
        <h2>Customize & Commit</h2>

        <div class="row">
          <label for="school-select">Select school:</label>
          <select id="school-select"></select>
          <button id="generate-variant">Generate Variant</button>
          <span id="gen-status" class="status"></span>
        </div>

        <div style="margin: 8px 0 4px;">
          <label for="prompt-input"><strong>Prompt Template</strong> (uses {{SCHOOL}}, {{TEMPLATE}}, {{RESEARCH}}, {{TAGS}}):</label>
          <textarea id="prompt-input" placeholder="Edit the prompt used to guide the LLM..."></textarea>
          <div class="row">
            <button id="save-prompt">Save Prompt</button>
            <button id="reset-prompt">Reset to Default</button>
            <span id="prompt-status" class="status"></span>
          </div>
        </div>

        <div class="panes">
          <div class="pane">
            <h3>Original Template</h3>
            <textarea id="orig-text" readonly></textarea>
          </div>
          <div class="pane">
            <h3>Modified Version (editable)</h3>
            <textarea id="mod-text" placeholder="Generated or edited variant will appear here..."></textarea>
          </div>
        </div>

        <div>
          <h3>Diff Preview</h3>
          <div id="diff-view" class="diff"></div>
        </div>

        <div class="row wrap">
          <button id="choose-root">Choose Export Directory</button>
          <span id="root-path" class="muted"></span>
        </div>
        <div class="row wrap">
          <button id="import-variants">Import From Directory</button>
          <span id="import-status" class="status"></span>
        </div>
        <div class="row">
          <button id="commit-variant">Commit to School Folder</button>
          <span id="commit-status" class="status"></span>
        </div>
        <div class="row wrap">
          <button id="download-variant">Download Variant</button>
          <button id="copy-variant">Copy to Clipboard</button>
          <button id="download-zip-all">Download All Variants (ZIP)</button>
          <span id="fallback-status" class="status"></span>
        </div>
      </section>
    </main>

    <footer>
      <small>All data is stored locally in your browser and filesystem. No server involved.</small>
    </footer>

    <script type="module" src="./app.js"></script>
  </body>
  </html>
